name: Test

on:
  workflow_dispatch:
  pull_request:
    branches: ["dev"]
    types: [opened, reopened, synchronize]

jobs:
  Test:
    name: Test code
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Run Lint
        run: |
          npm install
          npm run lint
        working-directory: my-app
        
      - name: Run build
        run: npm run build
        working-directory: my-app
    
  Notifications:
    name: Teams notification
    runs-on: ubuntu-latest
    steps:
    - name: Notify PR Opened or Reopened
      if: github.event.action == 'opened' || github.event.action == 'reopened'
      uses: mikesprague/teams-incoming-webhook-action@v1
      with:
        github-token: ${{ github.token }}
        webhook-url: ${{ secrets.MS_TEAMS_WEBHOOK_URL }}
        title: "ğŸ†•Pull Request Opened: Frontend (Dev)"
        message: |  
          ğŸ‘‰ğŸ¿ **PR Link:** [#${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})  
          ğŸ‘©ğŸ¿â€ğŸ“ **Author:** ${{ github.event.pull_request.user.name }}@${{ github.event.pull_request.user.login }}  
          â±ï¸ Created at: `${{ github.event.pull_request.created_at }}`
        color: "info"
        timezone: "Africa/Lagos"

    - name: Notify PR Updated (Commit Pushed)
      if: github.event.action == 'synchronize'
      uses: mikesprague/teams-incoming-webhook-action@v1
      with:
        github-token: ${{ github.token }}
        webhook-url: ${{ secrets.MS_TEAMS_WEBHOOK_URL }}
        title: "ğŸ”„Pull Request Updated: Frontend (Dev)"
        message: |
          ğŸ” **New commits pushed to PR:**  
          ğŸ‘‰ğŸ¿ **PR Link:** [#${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})  
          ğŸ‘©ğŸ¿â€ğŸ“ **Author:** ${{ github.event.pull_request.user.name }}@${{ github.event.pull_request.user.login }}  
          â±ï¸ Updated at: `${{ github.event.pull_request.updated_at }}`
        color: "warning"
        timezone: "Africa/Lagos"